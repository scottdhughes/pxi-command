name = "pxi-signals"
main = "src/worker.ts"
compatibility_date = "2024-10-01"

[triggers]
# Weekly schedule: Monday, Tuesday, Wednesday at 15:00 UTC.
# Tuesday/Wednesday include stale-data catch-up logic in src/worker.ts.
crons = ["0 15 * * 1", "0 15 * * 2", "0 15 * * 3"]

[env.staging]
name = "pxi-signals-staging"
routes = [
  { pattern = "pxicommand.com/signals-staging", zone_name = "pxicommand.com" },
  { pattern = "pxicommand.com/signals-staging/*", zone_name = "pxicommand.com" }
]
[[env.staging.d1_databases]]
binding = "SIGNALS_DB"
database_name = "pxi_signals"
database_id = "9d480cf6-3dc6-4e1f-b5d1-8e774a0e5105"

[[env.staging.r2_buckets]]
binding = "SIGNALS_BUCKET"
bucket_name = "pxi-signals"

[[env.staging.kv_namespaces]]
binding = "SIGNALS_KV"
id = "13003f5f87b144e1842f96b31a5ace61"

[env.staging.vars]
PUBLIC_BASE_PATH = "/signals-staging"
DEFAULT_LOOKBACK_DAYS = 7
DEFAULT_BASELINE_DAYS = 30
DEFAULT_TOP_N = 10
ENABLE_COMMENTS = 0
ENABLE_RSS = 0
PRICE_PROVIDER = "none"
BUILD_SHA = "local-dev"
BUILD_TIMESTAMP = "1970-01-01T00:00:00.000Z"
WORKER_VERSION = "signals-dev"

[env.production]
name = "pxi-signals"
routes = [
  { pattern = "pxicommand.com/signals", zone_name = "pxicommand.com" },
  { pattern = "pxicommand.com/signals/*", zone_name = "pxicommand.com" }
]
[[env.production.d1_databases]]
binding = "SIGNALS_DB"
database_name = "pxi_signals"
database_id = "9d480cf6-3dc6-4e1f-b5d1-8e774a0e5105"

[[env.production.r2_buckets]]
binding = "SIGNALS_BUCKET"
bucket_name = "pxi-signals"

[[env.production.kv_namespaces]]
binding = "SIGNALS_KV"
id = "13003f5f87b144e1842f96b31a5ace61"

[env.production.vars]
PUBLIC_BASE_PATH = "/signals"
DEFAULT_LOOKBACK_DAYS = 7
DEFAULT_BASELINE_DAYS = 30
DEFAULT_TOP_N = 10
ENABLE_COMMENTS = 0
ENABLE_RSS = 0
PRICE_PROVIDER = "none"
BUILD_SHA = "local-dev"
BUILD_TIMESTAMP = "1970-01-01T00:00:00.000Z"
WORKER_VERSION = "signals-dev"
